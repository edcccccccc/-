<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ä¼ æ„Ÿå™¨ä¹ é¢˜é›† - åˆ·é¢˜ç»ƒä¹ </title>

<style>
body {
    margin: 0;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    font-family: "Microsoft YaHei", sans-serif;
    padding-bottom: 70px;
}

/* é¡¶éƒ¨æ ‡é¢˜ */
.header {
    background: white;
    padding: 20px;
    text-align: center;
    font-size: 20px;
    font-weight: bold;
    color: #333;
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    position: relative;
    z-index: 2;
}

/* æ¨¡å¼åˆ‡æ¢æŒ‰é’® */
.mode-switcher {
    display: flex;
    background: white;
    margin: 20px;
    border-radius: 12px;
    overflow: hidden;
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
}

.mode-btn {
    flex: 1;
    padding: 16px;
    border: none;
    background: none;
    font-size: 16px;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.3s;
}

.mode-btn.active {
    background: #667eea;
    color: white;
}

/* ç« èŠ‚æ  */
.chapter-bar {
    display: flex;
    overflow-x: auto;
    background: white;
    border-radius: 12px;
    margin: 0 20px 20px 20px;
    padding: 0 10px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
}

.chapter-btn {
    padding: 14px 18px;
    font-size: 14px;
    white-space: nowrap;
    cursor: pointer;
    border-bottom: 3px solid transparent;
    transition: all 0.3s;
}

.chapter-btn.active {
    color: #667eea;
    border-bottom: 3px solid #667eea;
    font-weight: bold;
}

/* é¢˜ç›®å¡ç‰‡ */
.card {
    background: white;
    margin: 0 20px 20px 20px;
    padding: 25px;
    border-radius: 12px;
    box-shadow: 0 6px 16px rgba(0,0,0,0.1);
    min-height: 300px;
    display: flex;
    flex-direction: column;
}

.question-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
    padding-bottom: 15px;
    border-bottom: 2px solid #f0f0f0;
}

.type {
    font-size: 14px;
    padding: 6px 16px;
    background: #e3f2fd;
    color: #1976d2;
    border-radius: 20px;
    font-weight: 500;
}

.question-number {
    font-size: 14px;
    color: #666;
}

.question {
    font-size: 17px;
    line-height: 1.8;
    flex: 1;
    margin-bottom: 25px;
}

.question .blank {
    display: inline-block;
    min-width: 120px;
    height: 36px;
    border-bottom: 3px dashed #667eea;
    margin: 0 8px;
    vertical-align: middle;
    text-align: center;
    line-height: 36px;
    font-size: 16px;
    color: #333;
}

/* å¡«ç©ºé¢˜è¾“å…¥åŒºåŸŸ */
.fill-blank-section {
    margin-top: auto;
}

.answer-input-container {
    margin-bottom: 20px;
}

.answer-input {
    width: 100%;
    padding: 16px;
    border: 2px solid #e0e0e0;
    border-radius: 10px;
    font-size: 16px;
    box-sizing: border-box;
    transition: all 0.3s;
    font-family: "Microsoft YaHei", sans-serif;
}

.answer-input:focus {
    border-color: #667eea;
    outline: none;
    box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
}

/* è§£ç­”é¢˜ç­”æ¡ˆåŒºåŸŸ */
.essay-answer-section {
    background: #f8f9fa;
    border-radius: 10px;
    padding: 20px;
    margin-top: 20px;
    border-left: 4px solid #4caf50;
}

.essay-answer-section h4 {
    margin: 0 0 15px 0;
    color: #333;
    font-size: 16px;
}

.correct-answer {
    line-height: 1.7;
    font-size: 15px;
    color: #444;
    white-space: pre-line;
    padding: 15px;
    background: white;
    border-radius: 8px;
    border: 1px solid #e0e0e0;
}

/* æŒ‰é’®æ ·å¼ */
.action-buttons {
    display: flex;
    gap: 15px;
    margin-top: 20px;
}

.action-btn {
    flex: 1;
    padding: 16px;
    border: none;
    border-radius: 10px;
    font-size: 16px;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.3s;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
}

.submit-btn {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
}

.submit-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 12px rgba(102, 126, 234, 0.3);
}

.show-answer-btn {
    background: #f5f5f5;
    color: #333;
    border: 2px solid #e0e0e0;
}

.show-answer-btn:hover {
    background: #e8e8e8;
}

.next-btn {
    background: #4caf50;
    color: white;
}

.next-btn:hover {
    background: #43a047;
    transform: translateY(-2px);
}

/* æç¤ºæ¡† */
.hint-box {
    background: #fff3cd;
    border: 1px solid #ffeaa7;
    border-radius: 8px;
    padding: 15px;
    margin: 15px 0;
    color: #856404;
    display: none;
}

.hint-box.show {
    display: block;
    animation: fadeIn 0.3s ease;
}

@keyframes fadeIn {
    from { opacity: 0; transform: translateY(-10px); }
    to { opacity: 1; transform: translateY(0); }
}

/* åº•éƒ¨å¯¼èˆª */
.bottom-nav {
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
    display: flex;
    background: white;
    padding: 15px;
    box-shadow: 0 -4px 12px rgba(0,0,0,0.1);
    z-index: 100;
}

.nav-btn {
    flex: 1;
    padding: 14px;
    margin: 0 5px;
    border: 2px solid #667eea;
    background: white;
    color: #667eea;
    border-radius: 10px;
    font-size: 15px;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.3s;
}

.nav-btn:hover {
    background: #667eea;
    color: white;
    transform: translateY(-2px);
}

.nav-btn:disabled {
    opacity: 0.5;
    cursor: not-allowed;
    background: #f5f5f5;
    color: #999;
    border-color: #ddd;
}

/* ç»Ÿè®¡ä¿¡æ¯ */
.stats-bar {
    display: flex;
    justify-content: space-between;
    background: white;
    border-radius: 12px;
    margin: 0 20px 20px 20px;
    padding: 15px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
}

.stat-item {
    text-align: center;
    flex: 1;
}

.stat-value {
    font-size: 24px;
    font-weight: bold;
    color: #667eea;
    display: block;
}

.stat-label {
    font-size: 12px;
    color: #666;
    margin-top: 5px;
}

/* å“åº”å¼è®¾è®¡ */
@media (max-width: 768px) {
    .header {
        padding: 15px;
        font-size: 18px;
    }
    
    .card {
        padding: 20px;
        margin: 0 15px 15px 15px;
    }
    
    .question {
        font-size: 16px;
    }
    
    .action-buttons {
        flex-direction: column;
    }
    
    .bottom-nav {
        padding: 10px;
    }
    
    .nav-btn {
        padding: 12px;
        margin: 0 3px;
    }
}
</style>
</head>

<body>

<div class="header">ä¼ æ„Ÿå™¨ä¹ é¢˜é›†åˆ·é¢˜å·¥å…·</div>

<!-- æ¨¡å¼åˆ‡æ¢ -->
<div class="mode-switcher">
    <button class="mode-btn active" onclick="switchMode('fill')">å¡«ç©ºé¢˜æ¨¡å¼</button>
    <button class="mode-btn" onclick="switchMode('essay')">è§£ç­”é¢˜æ¨¡å¼</button>
</div>

<!-- ç»Ÿè®¡ä¿¡æ¯ -->
<div class="stats-bar">
    <div class="stat-item">
        <span class="stat-value" id="totalQuestions">0</span>
        <span class="stat-label">æ€»é¢˜æ•°</span>
    </div>
    <div class="stat-item">
        <span class="stat-value" id="currentProgress">0</span>
        <span class="stat-label">å½“å‰è¿›åº¦</span>
    </div>
    <div class="stat-item">
        <span class="stat-value" id="accuracyRate">0%</span>
        <span class="stat-label">æ­£ç¡®ç‡</span>
    </div>
</div>

<!-- ç« èŠ‚å¯¼èˆª -->
<div class="chapter-bar" id="chapters"></div>

<!-- é¢˜ç›®å¡ç‰‡ -->
<div class="card">
    <div class="question-header">
        <span class="type" id="questionType">å¡«ç©ºé¢˜</span>
        <span class="question-number" id="questionNumber">ç¬¬1é¢˜</span>
    </div>
    
    <div class="question" id="questionText"></div>
    
    <!-- å¡«ç©ºé¢˜éƒ¨åˆ† -->
    <div class="fill-blank-section" id="fillSection">
        <div class="answer-input-container">
            <input type="text" class="answer-input" id="userAnswer" 
                   placeholder="è¯·è¾“å…¥ç­”æ¡ˆï¼ˆç›´æ¥è¾“å…¥æ–‡å­—ï¼Œç©ºæ ¼åˆ†éš”å¤šä¸ªå¡«ç©ºï¼‰" 
                   onkeypress="handleEnterKey(event)">
        </div>
        
        <div class="hint-box" id="hintBox">
            <strong>ğŸ’¡ æ­£ç¡®ç­”æ¡ˆï¼š</strong><span id="correctAnswerText"></span>
        </div>
        
        <div class="action-buttons">
            <button class="action-btn submit-btn" onclick="submitAnswer()">
                <span>æäº¤ç­”æ¡ˆ</span>
            </button>
            <button class="action-btn show-answer-btn" onclick="showCorrectAnswer()">
                <span>æŸ¥çœ‹ç­”æ¡ˆ</span>
            </button>
            <button class="action-btn next-btn" onclick="nextQuestion()" id="nextBtn">
                <span>ä¸‹ä¸€é¢˜</span>
            </button>
        </div>
    </div>
    
    <!-- è§£ç­”é¢˜éƒ¨åˆ† -->
    <div class="essay-answer-section" id="essaySection" style="display: none;">
        <h4>å‚è€ƒç­”æ¡ˆï¼š</h4>
        <div class="correct-answer" id="essayAnswerText"></div>
        <div class="action-buttons" style="margin-top: 20px;">
            <button class="action-btn next-btn" onclick="nextQuestion()">
                <span>ä¸‹ä¸€é¢˜</span>
            </button>
        </div>
    </div>
</div>

<!-- åº•éƒ¨å¯¼èˆª -->
<div class="bottom-nav">
    <button class="nav-btn" onclick="prevChapter()" id="prevChapterBtn">ä¸Šä¸€ç« </button>
    <button class="nav-btn" onclick="prevQuestion()" id="prevQuestionBtn">ä¸Šä¸€é¢˜</button>
    <button class="nav-btn" onclick="nextQuestion()" id="nextQuestionBtn">ä¸‹ä¸€é¢˜</button>
    <button class="nav-btn" onclick="nextChapter()" id="nextChapterBtn">ä¸‹ä¸€ç« </button>
</div>

<script>
// ===== é¢˜åº“æ•°æ® =====
const questionBank = {
    "ç¬¬1ç«  æ¦‚è¿°": {
        fill: [
            { q: "ä¼ æ„Ÿå™¨æ˜¯èƒ½å¤Ÿæ„Ÿå—______å¹¶æŒ‰ç…§ä¸€å®šè§„å¾‹è½¬æ¢æˆå¯ç”¨è¾“å‡ºä¿¡å·çš„å™¨ä»¶å’Œè£…ç½®ã€‚", a: "è§„å®šçš„è¢«æµ‹é‡" },
            { q: "ä¼ æ„Ÿå™¨ç”±______ã€______å’Œ______ä¸‰éƒ¨åˆ†ç»„æˆã€‚", a: "æ•æ„Ÿå…ƒä»¶ã€è½¬æ¢å…ƒä»¶ã€åŸºæœ¬ç”µè·¯" },
            { q: "ä¼ æ„Ÿå™¨ä¸»è¦å‘å±•è¶‹åŠ¿åŒ…æ‹¬ï¼š______ã€ç½‘ç»œåŒ–ã€æ•°å­—åŒ–ã€______ã€å¾®å‹åŒ–ã€æ™ºèƒ½åŒ–ç­‰ã€‚", a: "é›†æˆåŒ–ã€å¤šåŠŸèƒ½åŒ–" }
        ],
        essay: [
            { q: "ç®€è¿°ä¼ æ„Ÿå™¨ä¸»è¦å‘å±•è¶‹åŠ¿ã€‚", a: "ç°ä»£ä¼ æ„Ÿå™¨æ­£æœç€é›†æˆåŒ–ã€ç½‘ç»œåŒ–ã€æ•°å­—åŒ–ã€å¤šåŠŸèƒ½åŒ–ã€å¾®å‹åŒ–ã€æ™ºèƒ½åŒ–å…‰æœºç”µä¸€ä½“åŒ–æ–¹å‘å‘å±•ï¼Œå…·æœ‰é«˜ç²¾åº¦ã€é«˜æ€§èƒ½ã€é«˜çµæ•åº¦ã€é«˜å¯é æ€§ã€é«˜ç¨³å®šæ€§ã€é•¿å¯¿å‘½ã€é«˜ä¿¡å™ªæ¯”ã€å®½é‡ç¨‹ã€æ— ç»´æŠ¤çš„ç‰¹ç‚¹ã€‚" },
            { q: "ç©ºè°ƒå’Œç”µå†°ç®±ä¸­é‡‡ç”¨äº†å“ªäº›ä¼ æ„Ÿå™¨ï¼Ÿå®ƒä»¬åˆ†åˆ«èµ·åˆ°ä»€ä¹ˆä½œç”¨ï¼Ÿ", a: "ç©ºè°ƒä¼ æ„Ÿå™¨ï¼šæ¸©åº¦ä¼ æ„Ÿå™¨æ£€æµ‹å®¤å†…/å®¤å¤–ç¯å¢ƒæ¸©åº¦ã€è’¸å‘å™¨æ¸©åº¦ç­‰ï¼Œæ§åˆ¶å‹ç¼©æœºå¯åœå’Œé£æœºé€Ÿåº¦ï¼›çº¢å¤–ä¼ æ„Ÿå™¨æ¥æ”¶é¥æ§ä¿¡å·ã€‚ç”µå†°ç®±ä¼ æ„Ÿå™¨ï¼šæ¸©åº¦ä¼ æ„Ÿå™¨ç›‘æµ‹å†·è—/å†·å†»å®¤æ¸©åº¦ï¼Œæ§åˆ¶å‹ç¼©æœºå¯åœå’Œé™¤éœœã€‚" }
        ]
    },
    "ç¬¬2ç«  ä¼ æ„Ÿå™¨çš„åŸºæœ¬ç‰¹æ€§": {
        fill: [
            { q: "ä¼ æ„Ÿå™¨çš„é™æ€ç‰¹æ€§æ˜¯æŒ‡å½“è¾“å…¥é‡ä¸º______æ—¶çš„è¾“å…¥è¾“å‡ºç‰¹æ€§ã€‚", a: "å¸¸æ•°æˆ–å˜åŒ–ææ…¢" },
            { q: "é™æ€ç‰¹æ€§çš„ä¸»è¦æŒ‡æ ‡åŒ…æ‹¬ï¼šçº¿æ€§åº¦ã€______ã€é‡å¤æ€§ã€______ã€ç¨³å®šæ€§ç­‰ã€‚", a: "è¿Ÿæ»ã€åˆ†è¾¨åŠ›" },
            { q: "çº¿æ€§åº¦æ˜¯å°†è¿‘ä¼¼åçš„______ä¸å®é™…æ›²çº¿è¿›è¡Œæ¯”è¾ƒçš„æœ€å¤§åå·®ã€‚", a: "æ‹Ÿåˆç›´çº¿" }
        ],
        essay: [
            { q: "ä¼ æ„Ÿå™¨çš„é™æ€ç‰¹æ€§æ˜¯ä»€ä¹ˆï¼Ÿç”±å“ªäº›æ€§èƒ½æŒ‡æ ‡æè¿°ï¼Ÿ", a: "é™ç‰¹æ€§æ˜¯å½“è¾“å…¥é‡ä¸ºå¸¸æ•°æˆ–å˜åŒ–ææ…¢æ—¶ï¼Œä¼ æ„Ÿå™¨çš„è¾“å…¥è¾“å‡ºç‰¹æ€§ã€‚å…¶ä¸»è¦æŒ‡æ ‡æœ‰çº¿æ€§åº¦ã€è¿Ÿæ»ã€é‡å¤æ€§ã€åˆ†è¾¨åŠ›ã€ç¨³å®šæ€§ã€æ¸©åº¦ç¨³å®šæ€§ã€å„ç§æŠ—å¹²æ‰°ç¨³å®šæ€§ã€‚" },
            { q: "ä¼ æ„Ÿå™¨çš„æ ‡å®šä¸æ ¡å‡†æœ‰ä»€ä¹ˆä¸åŒï¼Ÿ", a: "æ ‡å®šæ˜¯é€šè¿‡å®éªŒæˆ–è®¡ç®—ç¡®å®šä¼ æ„Ÿå™¨çš„æµ‹é‡é‡å’ŒçœŸå®å€¼ä¹‹é—´çš„å…³ç³»ï¼Œå»ºç«‹è¾“å‡ºé‡ä¸è¾“å…¥é‡çš„å¯¹åº”å…³ç³»ã€‚é€‚ç”¨äºè¾ƒé«˜ç²¾åº¦çš„ä»ªå™¨ï¼Œé€šå¸¸åœ¨ä½¿ç”¨å‰è¿›è¡Œã€‚æ ¡å‡†åœ¨ä½¿ç”¨å‰æˆ–ä½¿ç”¨è¿‡ç¨‹ä¸­ï¼Œé€šè¿‡å·²çŸ¥çš„æ ‡å‡†é‡å¯¹ä¼ æ„Ÿå™¨è¿›è¡Œè°ƒæ•´ï¼Œä½¿å…¶è¾“å‡ºæ›´åŠ å‡†ç¡®ã€‚" }
        ]
    },
    "ç¬¬3ç«  ç”µé˜»åº”å˜å¼ä¼ æ„Ÿå™¨": {
        fill: [
            { q: "å¯¼ä½“å› å˜å½¢è€Œä½¿å…¶ç”µé˜»å€¼å‘ç”Ÿå˜åŒ–çš„ç°è±¡ç§°ä¸º______ã€‚", a: "ç”µé˜»åº”å˜æ•ˆåº”" },
            { q: "é‡‘å±åº”å˜ç‰‡åˆ©ç”¨______æ•ˆåº”ï¼ŒåŠå¯¼ä½“åº”å˜ç‰‡åˆ©ç”¨______æ•ˆåº”ã€‚", a: "åº”å˜ã€å‹é˜»" },
            { q: "åŠå¯¼ä½“åº”å˜ç‰‡çš„çµæ•ç³»æ•°èŒƒå›´çº¦ä¸º______ã€‚", a: "50ï½100" }
        ],
        essay: [
            { q: "ä½•ä¸ºç”µé˜»åº”å˜æ•ˆåº”ï¼Ÿæ€æ ·åˆ©ç”¨è¿™ç§æ•ˆåº”åˆ¶æˆåº”å˜ç‰‡ï¼Ÿ", a: "å¯¼ä½“åœ¨å—åˆ°æ‹‰åŠ›æˆ–å‹åŠ›çš„å¤–ç•ŒåŠ›ä½œç”¨æ—¶ï¼Œä¼šäº§ç”Ÿæœºæ¢°å˜å½¢ï¼ŒåŒæ—¶æœºæ¢°å˜å½¢ä¼šå¼•èµ·å¯¼ä½“é˜»å€¼çš„å˜åŒ–ï¼Œè¿™ç§å¯¼ä½“ææ–™å› å˜å½¢è€Œä½¿å…¶ç”µé˜»å€¼å‘ç”Ÿå˜åŒ–çš„ç°è±¡ç§°ä¸ºç”µé˜»åº”å˜æ•ˆåº”ã€‚å½“å¤–åŠ›ä½œç”¨æ—¶ï¼Œå¯¼ä½“çš„ç”µé˜»ç‡ã€é•¿åº¦ã€æˆªé¢ç§¯éƒ½ä¼šå‘ç”Ÿå˜åŒ–ï¼Œä»è€Œå¼•èµ·ç”µé˜»å€¼çš„å˜åŒ–ï¼Œé€šè¿‡æµ‹é‡ç”µé˜»å€¼çš„å˜åŒ–ï¼Œæ£€æµ‹å‡ºå¤–ç•Œä½œç”¨åŠ›çš„å¤§å°ã€‚" },
            { q: "é‡‘å±åº”å˜ç‰‡ä¸åŠå¯¼ä½“åº”å˜ç‰‡åœ¨å·¥ä½œåŸç†ä¸Šæœ‰ä½•ä¸åŒï¼Ÿ", a: "é‡‘å±å¯¼ä½“åº”å˜ç‰‡çš„ç”µé˜»å˜åŒ–æ˜¯åˆ©ç”¨æœºæ¢°å½¢å˜äº§ç”Ÿçš„åº”å˜æ•ˆåº”ï¼Œå¯¹äºåŠå¯¼ä½“è€Œè¨€ï¼Œåº”å˜ä¼ æ„Ÿå™¨ä¸»è¦æ˜¯åˆ©ç”¨åŠå¯¼ä½“ææ–™çš„å‹é˜»æ•ˆåº”ã€‚é‡‘å±ç”µé˜»ä¸çš„çµæ•ç³»æ•°çº¦ä¸º2ï¼›åŠå¯¼ä½“çµæ•ç³»æ•°çº¦ä¸º50ï½100ã€‚" }
        ]
    },
    "ç¬¬4ç«  ç”µå®¹å¼ä¼ æ„Ÿå™¨": {
        fill: [
            { q: "ä¸ºæ”¹å–„å•æå¼å˜æè·å‹ç”µå®¹ä¼ æ„Ÿå™¨çš„éçº¿æ€§ï¼Œé€šå¸¸é‡‡ç”¨______ç»“æ„ã€‚", a: "å·®åŠ¨" },
            { q: "é«˜é¢‘å·¥ä½œæ—¶ç”µå®¹å¼ä¼ æ„Ÿå™¨è¿æ¥ç”µç¼†é•¿åº¦ä¸èƒ½ä»»æ„å˜åŒ–ï¼Œæ˜¯å› ä¸º______ä¸å¯å¿½ç•¥ã€‚", a: "ç”µç¼†ç­‰æ•ˆç”µæ„Ÿå’Œç”µé˜»" }
        ],
        essay: [
            { q: "å¦‚ä½•æ”¹å–„å•æå¼å˜æè·å‹ç”µå®¹ä¼ æ„Ÿå™¨çš„éçº¿æ€§ï¼Ÿ", a: "éçº¿æ€§éšç›¸å¯¹ä½ç§»çš„å¢åŠ è€Œå¢åŠ ï¼Œä¸ºä¿è¯çº¿æ€§åº¦åº”é™åˆ¶ç›¸å¯¹ä½ç§»çš„å¤§å°ï¼›èµ·å§‹æè·ä¸çµæ•åº¦ã€çº¿æ€§åº¦ç›¸çŸ›ç›¾ï¼Œæ‰€ä»¥å˜æè·å¼ç”µå®¹ä¼ æ„Ÿå™¨åªé€‚åˆå°ä½ç§»æµ‹é‡ï¼›ä¸ºæé«˜ä¼ æ„Ÿå™¨çš„çµæ•åº¦å’Œæ”¹å–„éçº¿æ€§å…³ç³»ï¼Œå˜æè·å¼ç”µå®¹ä¼ æ„Ÿå™¨ä¸€èˆ¬é‡‡ç”¨å·®åŠ¨ç»“æ„ã€‚" },
            { q: "ä¸ºä»€ä¹ˆé«˜é¢‘å·¥ä½œæ—¶çš„ç”µå®¹å¼ä¼ æ„Ÿå™¨è¿æ¥ç”µç¼†çš„é•¿åº¦ä¸èƒ½ä»»æ„å˜åŒ–ï¼Ÿ", a: "ä½é¢‘æ—¶å®¹æŠ—è¾ƒå¤§ï¼Œä¼ è¾“çº¿çš„ç­‰æ•ˆç”µæ„Ÿå’Œç”µé˜»å¯å¿½ç•¥ã€‚è€Œé«˜é¢‘æ—¶å®¹æŠ—å‡å°ï¼Œç­‰æ•ˆç”µæ„Ÿå’Œç”µé˜»ä¸å¯å¿½ç•¥ï¼Œè¿™æ—¶æ¥åœ¨ä¼ æ„Ÿå™¨è¾“å‡ºç«¯ç›¸å½“äºä¸€ä¸ªä¸²è”è°æŒ¯ï¼Œå½“å·¥ä½œé¢‘ç‡æ¥è¿‘è°æŒ¯é¢‘ç‡æ—¶ï¼Œè°æŒ¯å¯¹ä¼ æ„Ÿå™¨çš„è¾“å‡ºèµ·ç ´åä½œç”¨ï¼Œä½¿ç”µè·¯ä¸èƒ½æ­£å¸¸å·¥ä½œã€‚é€šå¸¸å·¥ä½œé¢‘ç‡10MHzä»¥ä¸Šå°±è¦è€ƒè™‘ç”µç¼†çº¿ç­‰æ•ˆç”µæ„Ÿçš„å½±å“ã€‚" }
        ]
    },
    "ç¬¬5ç«  ç”µæ„Ÿå¼ä¼ æ„Ÿå™¨": {
        fill: [
            { q: "ç”µæ„Ÿå¼ä¼ æ„Ÿå™¨åˆ©ç”¨çº¿åœˆ______å’Œ______çš„å˜åŒ–å®ç°éç”µé‡ç”µæµ‹ã€‚", a: "è‡ªæ„Ÿã€äº’æ„Ÿ" },
            { q: "æé«˜ç”µæ„Ÿå¼ä¼ æ„Ÿå™¨çº¿æ€§åº¦çš„æœ‰æ•ˆæ–¹æ³•æ˜¯é‡‡ç”¨______å½¢å¼å’Œ______ç”µè·¯ã€‚", a: "å·®åŠ¨ã€ç›¸æ•æ£€æ³¢" },
            { q: "é‡‘å±å¯¼ä½“åœ¨å˜åŒ–ç£åœºä¸­äº§ç”Ÿçš„é—­åˆç”µæµç§°ä¸º______ã€‚", a: "ç”µæ¶¡æµ" }
        ],
        essay: [
            { q: "ä½•è°“ç”µæ„Ÿå¼ä¼ æ„Ÿå™¨ï¼Ÿç”µæ„Ÿå¼ä¼ æ„Ÿå™¨åˆ†ä¸ºå“ªå‡ ç±»ï¼Ÿ", a: "ç”µæ„Ÿå¼ä¼ æ„Ÿå™¨æ˜¯ä¸€ç§æœº-ç”µè½¬æ¢è£…ç½®ï¼Œæ˜¯åˆ©ç”¨çº¿åœˆè‡ªæ„Ÿå’Œäº’æ„Ÿçš„å˜åŒ–å®ç°éç”µé‡ç”µæµ‹çš„ä¸€ç§è£…ç½®ï¼Œä¼ æ„Ÿå™¨åˆ©ç”¨ç”µç£æ„Ÿåº”å®šå¾‹å°†è¢«æµ‹éç”µé‡è½¬æ¢ä¸ºç”µæ„Ÿæˆ–äº’æ„Ÿçš„å˜åŒ–ã€‚ç§ç±»ï¼šè‡ªæ„Ÿå¼ã€æ¶¡æµå¼ã€å·®åŠ¨å¼ã€å˜å‹å¼ç­‰ã€‚" },
            { q: "ä»€ä¹ˆå«ç”µæ¶¡æµæ•ˆåº”ï¼Ÿè¯´æ˜ç”µæ¶¡æµå¼ä¼ æ„Ÿå™¨çš„åŸºæœ¬ç»“æ„ä¸å·¥ä½œåŸç†ã€‚", a: "å—çŠ¶é‡‘å±å¯¼ä½“ç½®äºå˜åŒ–çš„ç£åœºä¸­æˆ–åœ¨ç£åœºä¸­ä½œç”¨åˆ‡å‰²ç£åŠ›çº¿è¿åŠ¨æ—¶ï¼Œå¯¼ä½“å†…éƒ¨ä¼šäº§ç”Ÿä¸€åœˆåœˆé—­å’Œçš„ç”µæµï¼Œè¿™ç§ç”µæµå«ç”µæ¶¡æµï¼Œè¿™ç§ç°è±¡å«åšç”µæ¶¡æµæ•ˆåº”ã€‚å½¢æˆæ¶¡æµå¿…é¡»å…·å¤‡ä¸¤ä¸ªæ¡ä»¶ï¼šç¬¬ä¸€å­˜åœ¨äº¤å˜ç£åœºï¼›ç¬¬äºŒå¯¼ç”µä½“å¤„äºäº¤å˜ç£åœºä¸­ã€‚ç”µæ¶¡æµå¼ä¼ æ„Ÿå™¨é€šç”µåçº¿åœˆå‘¨å›´äº§ç”Ÿäº¤å˜ç£åœºï¼Œé‡‘å±å¯¼ä½“ç½®äºçº¿åœˆé™„è¿‘æ—¶ä¼šäº§ç”Ÿæ¶¡æµï¼Œè¿™ä¸ªæ¶¡æµåŒæ ·äº§ç”Ÿäº¤å˜ç£åœºã€‚ç”±äºç£åœºçš„åä½œç”¨ä½¿çº¿åœˆçš„ç­‰æ•ˆç”µæ„Ÿå’Œç­‰æ•ˆé˜»æŠ—å‘ç”Ÿå˜åŒ–ï¼Œé€šè¿‡æ£€æµ‹ä¸é˜»æŠ—æœ‰å…³çš„å‚æ•°è¿›è¡Œéç”µé‡æ£€æµ‹ã€‚" }
        ]
    },
    "ç¬¬6ç«  ç£ç”µå¼ä¼ æ„Ÿå™¨": {
        fill: [
            { q: "ç£ç”µæ„Ÿåº”å¼ä¼ æ„Ÿå™¨çš„å·¥ä½œåŸç†åŸºäº______å®šå¾‹ã€‚", a: "ç”µç£æ„Ÿåº”" },
            { q: "éœå°”æ•ˆåº”æ˜¯æŒ‡é€šç”µå¯¼ä½“åœ¨ç£åœºä¸­ï¼Œåœ¨______æ–¹å‘äº§ç”Ÿæ„Ÿåº”ç”µåŠ¨åŠ¿çš„ç°è±¡ã€‚", a: "ä¸ç”µæµå’Œç£åœºéƒ½å‚ç›´" }
        ],
        essay: [
            { q: "è¯•è¿°ç£ç”µæ„Ÿåº”å¼ä¼ æ„Ÿå™¨çš„å·¥ä½œåŸç†å’Œç»“æ„å½¢å¼ã€‚", a: "ç£ç”µæ„Ÿåº”å¼ä¼ æ„Ÿå™¨çš„å·¥ä½œåŸç†åŸºäºç”µç£æ„Ÿåº”å®šå¾‹ï¼Œå½“å¯¼ä½“åœ¨ç£åœºä¸­è¿åŠ¨åˆ‡å‰²ç£åŠ›çº¿æˆ–çº¿åœˆä¸­çš„ç£é€šå‘ç”Ÿå˜åŒ–æ—¶ï¼Œå¯¼ä½“æˆ–çº¿åœˆä¸­ä¼šäº§ç”Ÿæ„Ÿåº”ç”µåŠ¨åŠ¿ã€‚å…¶ç»“æ„å½¢å¼ä¸»è¦æœ‰åŠ¨åœˆå¼å’ŒåŠ¨é“å¼ã€‚" },
            { q: "ä»€ä¹ˆæ˜¯éœå°”æ•ˆåº”ï¼Ÿ", a: "é€šç”µçš„å¯¼ä½“ï¼ˆåŠå¯¼ä½“ï¼‰æ”¾åœ¨ç£åœºä¸­ï¼Œç”µæµä¸ç£åœºå‚ç›´ï¼Œåœ¨å¯¼ä½“å¦å¤–ä¸¤ä¾§ä¼šäº§ç”Ÿæ„Ÿåº”ç”µåŠ¨åŠ¿ï¼Œè¿™ç§ç°è±¡ç§°éœå°”æ•ˆåº”ã€‚" }
        ]
    },
    "ç¬¬7ç«  å‹ç”µå¼ä¼ æ„Ÿå™¨": {
        fill: [
            { q: "ç”µä»‹è´¨åœ¨å—åŠ›å˜å½¢æ—¶äº§ç”Ÿç”µè·çš„ç°è±¡ç§°ä¸º______ã€‚", a: "å‹ç”µæ•ˆåº”" },
            { q: "å‹ç”µå™¨ä»¶éœ€è¦é«˜é˜»æŠ—è¾“å‡ºï¼Œä¸»è¦æ˜¯ä¸ºäº†åŒ¹é…______è´Ÿè½½ã€‚", a: "é«˜é˜»æŠ—" }
        ],
        essay: [
            { q: "ä»€ä¹ˆæ˜¯å‹ç”µæ•ˆåº”ï¼Ÿä»€ä¹ˆæ˜¯æ­£å‹ç”µæ•ˆåº”å’Œé€†å‹ç”µæ•ˆåº”ï¼Ÿ", a: "æŸäº›ç”µä»‹è´¨åœ¨æ²¿ä¸€å®šçš„æ–¹å‘å—åˆ°å¤–åŠ›çš„ä½œç”¨å˜å½¢æ—¶ï¼Œç”±äºå†…éƒ¨ç”µæåŒ–ç°è±¡åŒæ—¶åœ¨ä¸¤ä¸ªè¡¨é¢ä¸Šäº§ç”Ÿç¬¦å·ç›¸åçš„ç”µè·ï¼Œå½“å¤–åŠ›å»æ‰åï¼Œæ¢å¤åˆ°ä¸å¸¦ç”µçš„çŠ¶æ€ï¼›è€Œå½“ä½œç”¨åŠ›æ–¹å‘æ”¹å˜æ—¶ï¼Œç”µè·çš„ææ€§éšç€æ”¹å˜ã€‚æ­£å‹ç”µæ•ˆåº”ä¹Ÿç§°å‹ç”µæ•ˆåº”ã€‚å¯¹æ™¶ä½“æ–½åŠ ä¸€å®šå˜ç”µåœºï¼Œæ™¶ä½“æœ¬èº«å°†äº§ç”Ÿæœºæ¢°å˜å½¢ï¼Œå¤–ç”µåœºæ’¤ç¦»ï¼Œå˜å½¢ä¹Ÿéšä¹‹æ¶ˆå¤±ï¼Œç§°ä¸ºé€†å‹ç”µæ•ˆåº”ã€‚" },
            { q: "ä¸ºä»€ä¹ˆå‹ç”µå™¨ä»¶ä¸€å®šè¦é«˜é˜»æŠ—è¾“å‡ºï¼Ÿ", a: "å‹ç”µå™¨ä»¶éœ€è¦é«˜é˜»æŠ—è¾“å‡ºï¼Œä¸»è¦æ˜¯ä¸ºäº†åŒ¹é…é«˜é˜»æŠ—è´Ÿè½½ï¼Œä»è€Œæé«˜ä¿¡å·ä¼ è¾“æ•ˆç‡ã€‚å‹ç”µå™¨ä»¶è¾“å‡ºçš„æ˜¯å¾®å¼±çš„ç”µè·ä¿¡å·ï¼Œå¦‚æœè´Ÿè½½é˜»æŠ—è¾ƒä½ï¼Œç”µè·ä¼šè¿…é€Ÿæ³„æ¼ï¼Œå¯¼è‡´ä¿¡å·å¤±çœŸæˆ–æµ‹é‡ä¸å‡†ç¡®ã€‚é«˜é˜»æŠ—è¾“å‡ºå¯ä»¥æœ‰æ•ˆå‡å°‘è¿™ç§ç”µè·æ³„æ¼ï¼Œä¿è¯ä¿¡å·çš„å®Œæ•´æ€§ã€‚" }
        ]
    },
    "ç¬¬8ç«  å…‰ç”µæ•ˆåº”åŠå™¨ä»¶": {
        fill: [
            { q: "å†…å…‰ç”µæ•ˆåº”åŒ…æ‹¬______æ•ˆåº”å’Œ______æ•ˆåº”ã€‚", a: "å…‰ç”µå¯¼ã€å…‰ç”Ÿä¼ç‰¹" },
            { q: "å…‰æ•ç”µé˜»çš„æš—ç”µé˜»é€šå¸¸ä¸º______é‡çº§ã€‚", a: "0.5ï½200MÎ©" }
        ],
        essay: [
            { q: "ä»€ä¹ˆæ˜¯å†…å…‰ç”µæ•ˆåº”ï¼Ÿä»€ä¹ˆæ˜¯å¤–å…‰ç”µæ•ˆåº”ï¼Ÿè¯´æ˜å…¶å·¥ä½œåŸç†å¹¶æŒ‡å‡ºç›¸åº”çš„å…¸å‹å…‰ç”µå™¨ä»¶ã€‚", a: "å½“å…‰çº¿ç…§åœ¨ç‰©ä½“ä¸Šï¼Œä½¿ç‰©ä½“çš„ç”µå¯¼ç‡å‘ç”Ÿå˜åŒ–ï¼Œæˆ–äº§ç”Ÿå…‰ç”Ÿç”µåŠ¨åŠ¿çš„ç°è±¡å«åšå†…å…‰ç”µæ•ˆåº”ï¼Œå†…å…‰ç”µæ•ˆåº”åˆåˆ†ä¸ºå…‰ç”µå¯¼æ•ˆåº”å’Œå…‰ç”Ÿä¼ç‰¹æ•ˆåº”ã€‚å…¥å°„å…‰å¼ºæ”¹å˜ç‰©è´¨å¯¼ç”µç‡çš„ç‰©ç†ç°è±¡ç§°å…‰ç”µå¯¼æ•ˆåº”ï¼Œå…¸å‹çš„å…‰ç”µå™¨ä»¶æœ‰å…‰æ•ç”µé˜»ï¼›å…‰ç…§æ—¶ç‰©ä½“ä¸­èƒ½äº§ç”Ÿä¸€å®šæ–¹å‘ç”µåŠ¨åŠ¿çš„ç°è±¡å«å…‰ç”Ÿä¼ç‰¹æ•ˆåº”ï¼Œå…‰ç”µæ± ã€å…‰æ•æ™¶ä½“ç®¡ã€‚åœ¨å…‰çº¿ä½œç”¨ä¸‹ï¼Œç‰©ä½“å†…çš„ç”µå­é€¸å‡ºç‰©ä½“è¡¨é¢å‘å¤–å‘å°„çš„ç°è±¡ç§°ä¸ºå¤–å…‰ç”µæ•ˆåº”ï¼Œå…¸å‹çš„å…‰ç”µå™¨ä»¶æœ‰å…‰ç”µç®¡ã€å…‰ç”µå€å¢ç®¡ã€‚" },
            { q: "ä»€ä¹ˆæ˜¯å…‰æ•ç”µé˜»çš„äº®ç”µé˜»å’Œæš—ç”µé˜»ï¼Ÿæš—ç”µé˜»ç”µé˜»å€¼é€šå¸¸åœ¨ä»€ä¹ˆèŒƒå›´ï¼Ÿ", a: "æš—ç”µé˜»ï¼Œæ— å…‰ç…§æ—¶çš„ç”µé˜»ä¸ºæš—ç”µé˜»ï¼Œæš—ç”µé˜»ç”µé˜»å€¼èŒƒå›´ä¸€èˆ¬ä¸º0.5ï½200MÎ©ï¼›äº®ç”µé˜»ã€å—å…‰ç…§æ—¶çš„ç”µé˜»ç§°äº®ç”µé˜»ï¼Œäº®ç”µé˜»çš„é˜»å€¼ä¸€èˆ¬ä¸º0.5ï½20KÎ©ã€‚" }
        ]
    },
    "ç¬¬9ç«  æ–°å‹å…‰ç”µä¼ æ„Ÿå™¨": {
        fill: [
            { q: "CCDä¸»è¦ç”±______å’Œ______ç»„æˆã€‚", a: "MOSå…‰æ•å…ƒé˜µåˆ—ã€è¯»å‡ºç§»ä½å¯„å­˜å™¨" },
            { q: "å…‰çº¤ä¼ æ„Ÿå™¨åˆ†ä¸º______å‹å’Œ______å‹ä¸¤å¤§ç±»ã€‚", a: "ä¼ å…‰ã€åŠŸèƒ½" }
        ],
        essay: [
            { q: "CCDä¸»è¦ç”±å“ªä¸¤éƒ¨åˆ†ç»„æˆï¼Ÿ", a: "MOSå…‰æ•å…ƒé˜µåˆ—ã€è¯»å‡ºç§»ä½å¯„å­˜å™¨ã€‚" },
            { q: "å…‰çº¤ä¼ æ„Ÿå™¨æœ‰å“ªä¸¤å¤§ç±»å‹ï¼Ÿ", a: "ä¼ å…‰å‹ï¼ŒåŠŸèƒ½å‹ã€‚" }
        ]
    }
};

// ===== å…¨å±€å˜é‡ =====
let currentChapter = "ç¬¬1ç«  æ¦‚è¿°";
let currentMode = "fill"; // 'fill' æˆ– 'essay'
let currentQuestionIndex = 0;
let answeredCorrectly = false;
let userStats = {
    totalAttempts: 0,
    correctAnswers: 0,
    currentChapterIndex: 0,
    chapterProgress: {}
};

// ===== åˆå§‹åŒ–ç« èŠ‚å¯¼èˆª =====
function initializeChapters() {
    const chapterBar = document.getElementById("chapters");
    chapterBar.innerHTML = "";
    
    const chapters = Object.keys(questionBank);
    chapters.forEach((chapter, index) => {
        const btn = document.createElement("div");
        btn.className = "chapter-btn" + (chapter === currentChapter ? " active" : "");
        btn.textContent = chapter;
        btn.onclick = () => switchChapter(chapter);
        chapterBar.appendChild(btn);
    });
}

// ===== åˆ‡æ¢ç« èŠ‚ =====
function switchChapter(chapter) {
    currentChapter = chapter;
    currentQuestionIndex = 0;
    answeredCorrectly = false;
    
    // æ›´æ–°ç« èŠ‚æŒ‰é’®çŠ¶æ€
    document.querySelectorAll(".chapter-btn").forEach(btn => {
        btn.classList.remove("active");
        if (btn.textContent === chapter) {
            btn.classList.add("active");
        }
    });
    
    // åŠ è½½é¢˜ç›®
    loadQuestion();
    updateStats();
    updateNavButtons();
}

// ===== åˆ‡æ¢æ¨¡å¼ =====
function switchMode(mode) {
    currentMode = mode;
    currentQuestionIndex = 0;
    answeredCorrectly = false;
    
    // æ›´æ–°æ¨¡å¼æŒ‰é’®çŠ¶æ€
    document.querySelectorAll(".mode-btn").forEach(btn => {
        btn.classList.remove("active");
    });
    document.querySelectorAll(".mode-btn")[mode === 'fill' ? 0 : 1].classList.add("active");
    
    // æ˜¾ç¤º/éšè—å¯¹åº”çš„éƒ¨åˆ†
    if (mode === 'fill') {
        document.getElementById("fillSection").style.display = 'block';
        document.getElementById("essaySection").style.display = 'none';
        document.getElementById("questionType").textContent = "å¡«ç©ºé¢˜";
        document.getElementById("userAnswer").value = "";
    } else {
        document.getElementById("fillSection").style.display = 'none';
        document.getElementById("essaySection").style.display = 'block';
        document.getElementById("questionType").textContent = "è§£ç­”é¢˜";
    }
    
    loadQuestion();
    updateStats();
}

// ===== åŠ è½½é¢˜ç›® =====
function loadQuestion() {
    const chapterQuestions = questionBank[currentChapter][currentMode];
    
    if (!chapterQuestions || chapterQuestions.length === 0) {
        document.getElementById("questionText").textContent = "æœ¬ç« æš‚æ— é¢˜ç›®";
        return;
    }
    
    const question = chapterQuestions[currentQuestionIndex];
    
    // æ›´æ–°é¢˜ç›®
    document.getElementById("questionText").textContent = question.q;
    document.getElementById("questionNumber").textContent = `ç¬¬${currentQuestionIndex + 1}é¢˜/å…±${chapterQuestions.length}é¢˜`;
    
    // æ›´æ–°ç­”æ¡ˆåŒºåŸŸ
    document.getElementById("correctAnswerText").textContent = question.a;
    document.getElementById("essayAnswerText").textContent = question.a;
    
    // é‡ç½®çŠ¶æ€
    document.getElementById("hintBox").classList.remove("show");
    document.getElementById("userAnswer").value = "";
    answeredCorrectly = false;
    
    // å¦‚æœæ˜¯å¡«ç©ºé¢˜æ¨¡å¼ï¼Œèšç„¦è¾“å…¥æ¡†
    if (currentMode === 'fill') {
        setTimeout(() => {
            document.getElementById("userAnswer").focus();
        }, 100);
    }
}

// ===== æäº¤ç­”æ¡ˆï¼ˆå¡«ç©ºé¢˜æ¨¡å¼ï¼‰ =====
function submitAnswer() {
    const userAnswer = document.getElementById("userAnswer").value.trim();
    const correctAnswer = questionBank[currentChapter][currentMode][currentQuestionIndex].a;
    
    userStats.totalAttempts++;
    
    // ç®€å•çš„ç­”æ¡ˆå¯¹æ¯”ï¼ˆå®é™…åº”ç”¨ä¸­å¯èƒ½éœ€è¦æ›´æ™ºèƒ½çš„åŒ¹é…ï¼‰
    const isCorrect = compareAnswers(userAnswer, correctAnswer);
    
    if (isCorrect) {
        userStats.correctAnswers++;
        answeredCorrectly = true;
        
        // æ˜¾ç¤ºæˆåŠŸæç¤º
        document.getElementById("hintBox").innerHTML = `
            <div style="color: #4caf50; font-weight: bold;">
                âœ“ å›ç­”æ­£ç¡®ï¼
            </div>
        `;
        document.getElementById("hintBox").classList.add("show");
        
        // è‡ªåŠ¨è·³è½¬åˆ°ä¸‹ä¸€é¢˜ï¼ˆå»¶è¿Ÿ1ç§’ï¼‰
        setTimeout(() => {
            nextQuestion();
        }, 1000);
    } else {
        // æ˜¾ç¤ºæ­£ç¡®ç­”æ¡ˆ
        document.getElementById("hintBox").innerHTML = `
            <div style="color: #f44336; font-weight: bold; margin-bottom: 8px;">
                âœ— ç­”æ¡ˆä¸æ­£ç¡®
            </div>
            <div><strong>ğŸ’¡ æ­£ç¡®ç­”æ¡ˆï¼š</strong>${correctAnswer}</div>
        `;
        document.getElementById("hintBox").classList.add("show");
    }
    
    updateStats();
}

// ===== ç­”æ¡ˆæ¯”è¾ƒå‡½æ•° =====
function compareAnswers(userAnswer, correctAnswer) {
    // ç®€å•æ¯”è¾ƒï¼šå»é™¤ç©ºæ ¼ï¼Œè½¬æ¢ä¸ºå°å†™è¿›è¡Œæ¯”è¾ƒ
    const user = userAnswer.replace(/\s+/g, '').toLowerCase();
    const correct = correctAnswer.replace(/\s+/g, '').toLowerCase();
    
    // å¦‚æœå®Œå…¨åŒ¹é…
    if (user === correct) return true;
    
    // å¦‚æœç”¨æˆ·ç­”æ¡ˆåŒ…å«åœ¨æ­£ç¡®ç­”æ¡ˆä¸­ï¼Œæˆ–è€…æ­£ç¡®ç­”æ¡ˆåŒ…å«åœ¨ç”¨æˆ·ç­”æ¡ˆä¸­
    if (user.includes(correct) || correct.includes(user)) return true;
    
    // å¯¹äºå¤šä¸ªå¡«ç©ºçš„ç­”æ¡ˆï¼Œå…è®¸ä»¥ä»»ä½•é¡ºåºè¾“å…¥
    if (correct.includes('ã€') || correct.includes(',')) {
        const correctParts = correct.split(/[ã€,]/).filter(p => p.trim()).map(p => p.trim());
        const userParts = user.split(/[ã€,]/).filter(p => p.trim()).map(p => p.trim());
        
        // æ£€æŸ¥æ˜¯å¦æ‰€æœ‰æ­£ç¡®ç­”æ¡ˆéƒ¨åˆ†éƒ½å‡ºç°åœ¨ç”¨æˆ·ç­”æ¡ˆä¸­
        const allPartsMatched = correctParts.every(part => user.includes(part));
        if (allPartsMatched && correctParts.length === userParts.length) return true;
    }
    
    return false;
}

// ===== æ˜¾ç¤ºç­”æ¡ˆï¼ˆå¡«ç©ºé¢˜æ¨¡å¼ï¼‰ =====
function showCorrectAnswer() {
    const correctAnswer = questionBank[currentChapter][currentMode][currentQuestionIndex].a;
    
    document.getElementById("hintBox").innerHTML = `
        <div style="font-weight: bold; margin-bottom: 8px; color: #2196f3;">
            ğŸ’¡ æ­£ç¡®ç­”æ¡ˆï¼š
        </div>
        <div>${correctAnswer}</div>
    `;
    document.getElementById("hintBox").classList.add("show");
}

// ===== é¢˜ç›®å¯¼èˆª =====
function prevQuestion() {
    const chapterQuestions = questionBank[currentChapter][currentMode];
    if (chapterQuestions.length === 0) return;
    
    if (currentQuestionIndex > 0) {
        currentQuestionIndex--;
    } else {
        // å¦‚æœæ˜¯ç¬¬ä¸€é¢˜ï¼Œè½¬åˆ°ä¸Šä¸€ç« çš„æœ€åä¸€é¢˜
        const chapters = Object.keys(questionBank);
        const currentIndex = chapters.indexOf(currentChapter);
        if (currentIndex > 0) {
            switchChapter(chapters[currentIndex - 1]);
            const prevChapterQuestions = questionBank[chapters[currentIndex - 1]][currentMode];
            currentQuestionIndex = prevChapterQuestions.length - 1;
        } else {
            currentQuestionIndex = 0;
        }
    }
    
    loadQuestion();
    updateNavButtons();
}

function nextQuestion() {
    const chapterQuestions = questionBank[currentChapter][currentMode];
    if (chapterQuestions.length === 0) return;
    
    if (currentQuestionIndex < chapterQuestions.length - 1) {
        currentQuestionIndex++;
    } else {
        // å¦‚æœæ˜¯æœ€åä¸€é¢˜ï¼Œè½¬åˆ°ä¸‹ä¸€ç« çš„ç¬¬ä¸€é¢˜
        const chapters = Object.keys(questionBank);
        const currentIndex = chapters.indexOf(currentChapter);
        if (currentIndex < chapters.length - 1) {
            switchChapter(chapters[currentIndex + 1]);
            currentQuestionIndex = 0;
        } else {
            currentQuestionIndex = 0;
            alert("å·²ç»æ˜¯æœ€åä¸€ç« çš„æœ€åä¸€é¢˜ï¼Œå°†ä»å¤´å¼€å§‹");
        }
    }
    
    loadQuestion();
    updateNavButtons();
}

// ===== ç« èŠ‚å¯¼èˆª =====
function prevChapter() {
    const chapters = Object.keys(questionBank);
    const currentIndex = chapters.indexOf(currentChapter);
    if (currentIndex > 0) {
        switchChapter(chapters[currentIndex - 1]);
    }
}

function nextChapter() {
    const chapters = Object.keys(questionBank);
    const currentIndex = chapters.indexOf(currentChapter);
    if (currentIndex < chapters.length - 1) {
        switchChapter(chapters[currentIndex + 1]);
    }
}

// ===== æ›´æ–°å¯¼èˆªæŒ‰é’®çŠ¶æ€ =====
function updateNavButtons() {
    const chapters = Object.keys(questionBank);
    const currentIndex = chapters.indexOf(currentChapter);
    const chapterQuestions = questionBank[currentChapter][currentMode];
    
    // æ›´æ–°ä¸Šä¸€ç« /ä¸‹ä¸€ç« æŒ‰é’®
    document.getElementById("prevChapterBtn").disabled = currentIndex === 0;
    document.getElementById("nextChapterBtn").disabled = currentIndex === chapters.length - 1;
    
    // æ›´æ–°ä¸Šä¸€é¢˜/ä¸‹ä¸€é¢˜æŒ‰é’®
    document.getElementById("prevQuestionBtn").disabled = currentQuestionIndex === 0 && currentIndex === 0;
    document.getElementById("nextQuestionBtn").disabled = 
        currentQuestionIndex === chapterQuestions.length - 1 && 
        currentIndex === chapters.length - 1;
}

// ===== æ›´æ–°ç»Ÿè®¡ä¿¡æ¯ =====
function updateStats() {
    const chapters = Object.keys(questionBank);
    let totalQuestions = 0;
    
    // è®¡ç®—æ€»é¢˜æ•°
    chapters.forEach(chapter => {
        totalQuestions += questionBank[chapter].fill.length;
        totalQuestions += questionBank[chapter].essay.length;
    });
    
    // è®¡ç®—å½“å‰è¿›åº¦
    const currentChapterIndex = chapters.indexOf(currentChapter);
    let completedChapters = currentChapterIndex;
    const currentChapterQuestions = questionBank[currentChapter][currentMode];
    const progressInCurrentChapter = currentChapterQuestions.length > 0 ? 
        ((currentQuestionIndex + 1) / currentChapterQuestions.length) * 100 : 0;
    
    const overallProgress = Math.round(((completedChapters + (progressInCurrentChapter / 100)) / chapters.length) * 100);
    
    // è®¡ç®—æ­£ç¡®ç‡
    const accuracy = userStats.totalAttempts > 0 ? 
        Math.round((userStats.correctAnswers / userStats.totalAttempts) * 100) : 0;
    
    // æ›´æ–°æ˜¾ç¤º
    document.getElementById("totalQuestions").textContent = totalQuestions;
    document.getElementById("currentProgress").textContent = `${overallProgress}%`;
    document.getElementById("accuracyRate").textContent = `${accuracy}%`;
}

// ===== å›è½¦é”®æäº¤ç­”æ¡ˆ =====
function handleEnterKey(event) {
    if (event.key === 'Enter') {
        submitAnswer();
    }
}

// ===== åˆå§‹åŒ– =====
function initialize() {
    initializeChapters();
    loadQuestion();
    updateStats();
    updateNavButtons();
}

// é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
document.addEventListener('DOMContentLoaded', initialize);

// é”®ç›˜å¿«æ·é”®æ”¯æŒ
document.addEventListener('keydown', function(e) {
    switch(e.key) {
        case 'ArrowLeft':
            if (e.ctrlKey) prevChapter();
            else prevQuestion();
            break;
        case 'ArrowRight':
            if (e.ctrlKey) nextChapter();
            else nextQuestion();
            break;
        case '1':
            switchMode('fill');
            break;
        case '2':
            switchMode('essay');
            break;
    }
});
</script>
</body>
</html>
