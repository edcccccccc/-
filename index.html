<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ä¼ æ„Ÿå™¨ä¹ é¢˜é›† - å¡«ç©ºé¢˜&è§£ç­”é¢˜</title>

<style>
body {
    margin: 0;
    background: #f2f2f2;
    font-family: "Microsoft YaHei", sans-serif;
    padding-bottom: 60px;
}

/* é¡¶éƒ¨æ ‡é¢˜ */
.header {
    background: #1976d2;
    padding: 16px;
    text-align: center;
    font-size: 18px;
    font-weight: bold;
    color: white;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

/* ç« èŠ‚æ  */
.chapter-bar {
    display: flex;
    overflow-x: auto;
    background: #fff;
    border-bottom: 1px solid #ddd;
    padding: 0 8px;
    position: sticky;
    top: 0;
    z-index: 10;
}

.chapter-btn {
    padding: 12px 16px;
    font-size: 14px;
    white-space: nowrap;
    cursor: pointer;
    border-bottom: 3px solid transparent;
}

.chapter-btn.active {
    color: #1976d2;
    border-bottom: 3px solid #1976d2;
    font-weight: bold;
}

/* é¢˜ç›®å¡ç‰‡ */
.card {
    background: #fff;
    margin: 16px;
    padding: 20px;
    border-radius: 10px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.08);
}

.question-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 15px;
    padding-bottom: 10px;
    border-bottom: 1px solid #eee;
}

.type {
    font-size: 14px;
    color: #666;
    padding: 4px 12px;
    background: #f5f5f5;
    border-radius: 15px;
}

.question-number {
    font-size: 14px;
    color: #888;
}

.question {
    font-size: 16px;
    line-height: 1.7;
    margin-bottom: 20px;
    min-height: 60px;
}

.question .blank {
    display: inline-block;
    min-width: 100px;
    height: 32px;
    border-bottom: 2px dashed #1976d2;
    margin: 0 5px;
    vertical-align: middle;
    text-align: center;
    line-height: 32px;
}

/* å¡«ç©ºé¢˜è¾“å…¥åŒºåŸŸ */
.fill-blank {
    margin-top: 20px;
    padding: 15px;
    background: #f9f9f9;
    border-radius: 8px;
    border-left: 4px solid #1976d2;
}

.fill-blank h4 {
    margin-top: 0;
    margin-bottom: 10px;
    color: #333;
}

.answer-input {
    width: 100%;
    padding: 12px;
    border: 2px solid #ddd;
    border-radius: 6px;
    font-size: 15px;
    box-sizing: border-box;
    margin-bottom: 10px;
}

.answer-input:focus {
    border-color: #1976d2;
    outline: none;
}

/* è§£ç­”é¢˜æ ·å¼ */
.answer-area {
    margin-top: 20px;
    padding: 15px;
    background: #f8f9fa;
    border-radius: 8px;
    border: 1px solid #e9ecef;
}

.answer-area h4 {
    margin-top: 0;
    margin-bottom: 15px;
    color: #2e7d32;
}

.correct-answer {
    white-space: pre-line;
    line-height: 1.6;
    padding: 15px;
    background: #f1f8e9;
    border-radius: 6px;
    margin-top: 10px;
    display: none;
    border-left: 4px solid #4caf50;
}

/* æŒ‰é’®æ ·å¼ */
.button-group {
    display: flex;
    gap: 10px;
    margin-top: 15px;
}

.btn {
    flex: 1;
    padding: 12px;
    border: none;
    border-radius: 6px;
    font-size: 15px;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.3s;
}

.btn-primary {
    background: #1976d2;
    color: white;
}

.btn-primary:hover {
    background: #1565c0;
}

.btn-secondary {
    background: #f5f5f5;
    color: #333;
    border: 1px solid #ddd;
}

.btn-secondary:hover {
    background: #e9e9e9;
}

.btn-success {
    background: #2e7d32;
    color: white;
}

.btn-success:hover {
    background: #1b5e20;
}

/* åº•éƒ¨æŒ‰é’® */
.footer {
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
    display: flex;
    background: #fff;
    border-top: 1px solid #ddd;
    padding: 10px;
    box-shadow: 0 -2px 8px rgba(0,0,0,0.05);
}

.footer button {
    flex: 1;
    padding: 14px;
    border: none;
    background: none;
    font-size: 15px;
    font-weight: 500;
    color: #333;
}

.footer button:hover {
    background: #f5f5f5;
}

.footer button:nth-child(2) {
    background: #333;
    color: #fff;
    border-radius: 4px;
    margin: 0 10px;
}

.footer button:nth-child(2):hover {
    background: #555;
}

/* ç»Ÿè®¡ä¿¡æ¯ */
.stats {
    text-align: center;
    padding: 10px;
    font-size: 14px;
    color: #666;
    background: #fff;
    border-bottom: 1px solid #eee;
}
</style>
</head>

<body>

<div class="header">ä¼ æ„Ÿå™¨ä¹ é¢˜é›† - åˆ·é¢˜ç»ƒä¹ </div>

<div class="stats">
    å·²å­¦ä¹ ï¼š<span id="learnedCount">0</span>é¢˜ | æ­£ç¡®ç‡ï¼š<span id="accuracy">0%</span>
</div>

<div class="chapter-bar" id="chapters"></div>

<div class="card">
    <div class="question-header">
        <span class="type" id="type">å¡«ç©ºé¢˜</span>
        <span class="question-number" id="questionNumber">ç¬¬1é¢˜/å…±0é¢˜</span>
    </div>
    <div class="question" id="question"></div>
    
    <!-- å¡«ç©ºé¢˜è¾“å…¥åŒºåŸŸ -->
    <div class="fill-blank" id="fillBlankArea" style="display: none;">
        <h4>è¯·å¡«å†™ç­”æ¡ˆï¼š</h4>
        <input type="text" class="answer-input" id="userAnswer" placeholder="è¯·è¾“å…¥ä½ çš„ç­”æ¡ˆ...">
        <div class="button-group">
            <button class="btn btn-primary" onclick="checkAnswer()">æäº¤ç­”æ¡ˆ</button>
            <button class="btn btn-secondary" onclick="showHint()">æŸ¥çœ‹æç¤º</button>
        </div>
    </div>
    
    <!-- è§£ç­”é¢˜æ˜¾ç¤ºåŒºåŸŸ -->
    <div class="answer-area" id="essayArea" style="display: none;">
        <h4>å‚è€ƒç­”æ¡ˆï¼š</h4>
        <div class="correct-answer" id="correctAnswer"></div>
        <div class="button-group">
            <button class="btn btn-success" onclick="showFullAnswer()">æŸ¥çœ‹å®Œæ•´ç­”æ¡ˆ</button>
            <button class="btn btn-secondary" onclick="markAsLearned()">æ ‡è®°ä¸ºå·²æŒæ¡</button>
        </div>
    </div>
</div>

<div class="footer">
    <button onclick="prevQuestion()">ä¸Šä¸€é¢˜</button>
    <button onclick="toggleAnswerMode()" id="toggleBtn">åˆ‡æ¢ä¸ºè§£ç­”é¢˜</button>
    <button onclick="nextQuestion()">ä¸‹ä¸€é¢˜</button>
</div>

<script>
// ===== é¢˜åº“ï¼ˆä»æ–‡æ¡£ä¸­æå–ï¼‰=====
const questionBank = {
    "ç¬¬1ç«  æ¦‚è¿°": [
        {
            q: "ä¼ æ„Ÿå™¨æ˜¯èƒ½å¤Ÿæ„Ÿå—______å¹¶æŒ‰ç…§ä¸€å®šè§„å¾‹è½¬æ¢æˆå¯ç”¨è¾“å‡ºä¿¡å·çš„å™¨ä»¶å’Œè£…ç½®ã€‚",
            a: "è§„å®šçš„è¢«æµ‹é‡",
            hint: "æ ¹æ®å›½å®¶æ ‡å‡†GB7665-87çš„å®šä¹‰"
        },
        {
            q: "ä¼ æ„Ÿå™¨ç”±______ã€______å’Œ______ä¸‰éƒ¨åˆ†ç»„æˆã€‚",
            a: "æ•æ„Ÿå…ƒä»¶ã€è½¬æ¢å…ƒä»¶ã€åŸºæœ¬ç”µè·¯",
            hint: "ä¼ æ„Ÿå™¨ä¸‰å¤§æ ¸å¿ƒç»„æˆéƒ¨åˆ†"
        },
        {
            q: "ä¼ æ„Ÿå™¨ä¸»è¦å‘å±•è¶‹åŠ¿åŒ…æ‹¬ï¼š______ã€ç½‘ç»œåŒ–ã€æ•°å­—åŒ–ã€______ã€å¾®å‹åŒ–ã€æ™ºèƒ½åŒ–ç­‰ã€‚",
            a: "é›†æˆåŒ–ã€å¤šåŠŸèƒ½åŒ–",
            hint: "ç°ä»£ä¼ æ„Ÿå™¨çš„å‘å±•æ–¹å‘"
        },
        {
            q: "ç©ºè°ƒä¸­çš„æ¸©åº¦ä¼ æ„Ÿå™¨ç”¨äºæ£€æµ‹______æ¸©åº¦ï¼Œæ§åˆ¶______ã€‚",
            a: "å®¤å†…/å®¤å¤–ç¯å¢ƒå’Œè’¸å‘å™¨ã€å‹ç¼©æœºå¯åœå’Œé£æœºé€Ÿåº¦",
            hint: "ç©ºè°ƒä¼ æ„Ÿå™¨çš„åŠŸèƒ½"
        }
    ],
    "ç¬¬2ç«  ä¼ æ„Ÿå™¨çš„åŸºæœ¬ç‰¹æ€§": [
        {
            q: "ä¼ æ„Ÿå™¨çš„é™æ€ç‰¹æ€§æ˜¯æŒ‡å½“è¾“å…¥é‡ä¸º______æ—¶çš„è¾“å…¥è¾“å‡ºç‰¹æ€§ã€‚",
            a: "å¸¸æ•°æˆ–å˜åŒ–ææ…¢",
            hint: "é™æ€ç‰¹æ€§çš„å®šä¹‰æ¡ä»¶"
        },
        {
            q: "é™æ€ç‰¹æ€§çš„ä¸»è¦æŒ‡æ ‡åŒ…æ‹¬ï¼šçº¿æ€§åº¦ã€______ã€é‡å¤æ€§ã€______ã€ç¨³å®šæ€§ç­‰ã€‚",
            a: "è¿Ÿæ»ã€åˆ†è¾¨åŠ›",
            hint: "å¸¸ç”¨çš„é™æ€æ€§èƒ½æŒ‡æ ‡"
        },
        {
            q: "çº¿æ€§åº¦æ˜¯å°†è¿‘ä¼¼åçš„______ä¸å®é™…æ›²çº¿è¿›è¡Œæ¯”è¾ƒçš„æœ€å¤§åå·®ã€‚",
            a: "æ‹Ÿåˆç›´çº¿",
            hint: "çº¿æ€§åº¦çš„è®¡ç®—æ–¹æ³•"
        },
        {
            q: "ä¼ æ„Ÿå™¨çš„æ ‡å®šæ˜¯é€šè¿‡å®éªŒç¡®å®šä¼ æ„Ÿå™¨æµ‹é‡é‡å’Œ______ä¹‹é—´çš„å…³ç³»ã€‚",
            a: "çœŸå®å€¼",
            hint: "æ ‡å®šçš„ç›®çš„"
        }
    ],
    "ç¬¬3ç«  ç”µé˜»åº”å˜å¼ä¼ æ„Ÿå™¨": [
        {
            q: "å¯¼ä½“å› å˜å½¢è€Œä½¿å…¶ç”µé˜»å€¼å‘ç”Ÿå˜åŒ–çš„ç°è±¡ç§°ä¸º______ã€‚",
            a: "ç”µé˜»åº”å˜æ•ˆåº”",
            hint: "ç”µé˜»å˜åŒ–ä¸æœºæ¢°å˜å½¢çš„å…³ç³»"
        },
        {
            q: "é‡‘å±åº”å˜ç‰‡åˆ©ç”¨______æ•ˆåº”ï¼ŒåŠå¯¼ä½“åº”å˜ç‰‡åˆ©ç”¨______æ•ˆåº”ã€‚",
            a: "åº”å˜ã€å‹é˜»",
            hint: "ä¸¤ç§åº”å˜ç‰‡çš„å·¥ä½œåŸç†åŒºåˆ«"
        },
        {
            q: "åŠå¯¼ä½“åº”å˜ç‰‡çš„çµæ•ç³»æ•°èŒƒå›´çº¦ä¸º______ã€‚",
            a: "50ï½100",
            hint: "åŠå¯¼ä½“åº”å˜ç‰‡çš„çµæ•åº¦ç‰¹ç‚¹"
        }
    ],
    "ç¬¬4ç«  ç”µå®¹å¼ä¼ æ„Ÿå™¨": [
        {
            q: "ä¸ºæ”¹å–„å•æå¼å˜æè·å‹ç”µå®¹ä¼ æ„Ÿå™¨çš„éçº¿æ€§ï¼Œé€šå¸¸é‡‡ç”¨______ç»“æ„ã€‚",
            a: "å·®åŠ¨",
            hint: "æ”¹å–„çº¿æ€§çš„å¸¸ç”¨æ–¹æ³•"
        },
        {
            q: "é«˜é¢‘å·¥ä½œæ—¶ç”µå®¹å¼ä¼ æ„Ÿå™¨è¿æ¥ç”µç¼†é•¿åº¦ä¸èƒ½ä»»æ„å˜åŒ–ï¼Œæ˜¯å› ä¸º______ä¸å¯å¿½ç•¥ã€‚",
            a: "ç”µç¼†ç­‰æ•ˆç”µæ„Ÿå’Œç”µé˜»",
            hint: "é«˜é¢‘æ—¶çš„åˆ†å¸ƒå‚æ•°å½±å“"
        }
    ],
    "ç¬¬5ç«  ç”µæ„Ÿå¼ä¼ æ„Ÿå™¨": [
        {
            q: "ç”µæ„Ÿå¼ä¼ æ„Ÿå™¨åˆ©ç”¨çº¿åœˆ______å’Œ______çš„å˜åŒ–å®ç°éç”µé‡ç”µæµ‹ã€‚",
            a: "è‡ªæ„Ÿã€äº’æ„Ÿ",
            hint: "ç”µæ„Ÿä¼ æ„Ÿå™¨çš„ä¸¤ç§å˜åŒ–æ–¹å¼"
        },
        {
            q: "æé«˜ç”µæ„Ÿå¼ä¼ æ„Ÿå™¨çº¿æ€§åº¦çš„æœ‰æ•ˆæ–¹æ³•æ˜¯é‡‡ç”¨______å½¢å¼å’Œ______ç”µè·¯ã€‚",
            a: "å·®åŠ¨ã€ç›¸æ•æ£€æ³¢",
            hint: "æ”¹å–„çº¿æ€§çš„æŠ€æœ¯æ‰‹æ®µ"
        },
        {
            q: "é‡‘å±å¯¼ä½“åœ¨å˜åŒ–ç£åœºä¸­äº§ç”Ÿçš„é—­åˆç”µæµç§°ä¸º______ã€‚",
            a: "ç”µæ¶¡æµ",
            hint: "ç”µç£æ„Ÿåº”ç°è±¡çš„åç§°"
        }
    ],
    "ç¬¬6ç«  ç£ç”µå¼ä¼ æ„Ÿå™¨": [
        {
            q: "ç£ç”µæ„Ÿåº”å¼ä¼ æ„Ÿå™¨çš„å·¥ä½œåŸç†åŸºäº______å®šå¾‹ã€‚",
            a: "ç”µç£æ„Ÿåº”",
            hint: "åŸºæœ¬çš„ç”µç£å­¦åŸç†"
        },
        {
            q: "éœå°”æ•ˆåº”æ˜¯æŒ‡é€šç”µå¯¼ä½“åœ¨ç£åœºä¸­ï¼Œåœ¨______æ–¹å‘äº§ç”Ÿæ„Ÿåº”ç”µåŠ¨åŠ¿çš„ç°è±¡ã€‚",
            a: "ä¸ç”µæµå’Œç£åœºéƒ½å‚ç›´",
            hint: "éœå°”æ•ˆåº”çš„æ–¹å‘ç‰¹å¾"
        }
    ],
    "ç¬¬7ç«  å‹ç”µå¼ä¼ æ„Ÿå™¨": [
        {
            q: "ç”µä»‹è´¨åœ¨å—åŠ›å˜å½¢æ—¶äº§ç”Ÿç”µè·çš„ç°è±¡ç§°ä¸º______ã€‚",
            a: "å‹ç”µæ•ˆåº”",
            hint: "å‹ç”µç°è±¡çš„åç§°"
        },
        {
            q: "å‹ç”µå™¨ä»¶éœ€è¦é«˜é˜»æŠ—è¾“å‡ºï¼Œä¸»è¦æ˜¯ä¸ºäº†åŒ¹é…______è´Ÿè½½ã€‚",
            a: "é«˜é˜»æŠ—",
            hint: "é˜»æŠ—åŒ¹é…çš„è¦æ±‚"
        }
    ],
    "ç¬¬8ç«  å…‰ç”µæ•ˆåº”åŠå™¨ä»¶": [
        {
            q: "å†…å…‰ç”µæ•ˆåº”åŒ…æ‹¬______æ•ˆåº”å’Œ______æ•ˆåº”ã€‚",
            a: "å…‰ç”µå¯¼ã€å…‰ç”Ÿä¼ç‰¹",
            hint: "å†…å…‰ç”µæ•ˆåº”çš„ä¸¤ç§ç±»å‹"
        },
        {
            q: "å…‰æ•ç”µé˜»çš„æš—ç”µé˜»é€šå¸¸ä¸º______é‡çº§ã€‚",
            a: "0.5ï½200MÎ©",
            hint: "æš—ç”µé˜»çš„å…¸å‹èŒƒå›´"
        }
    ],
    "ç¬¬9ç«  æ–°å‹å…‰ç”µä¼ æ„Ÿå™¨": [
        {
            q: "CCDä¸»è¦ç”±______å’Œ______ç»„æˆã€‚",
            a: "MOSå…‰æ•å…ƒé˜µåˆ—ã€è¯»å‡ºç§»ä½å¯„å­˜å™¨",
            hint: "CCDçš„ä¸¤ä¸ªä¸»è¦éƒ¨åˆ†"
        },
        {
            q: "å…‰çº¤ä¼ æ„Ÿå™¨åˆ†ä¸º______å‹å’Œ______å‹ä¸¤å¤§ç±»ã€‚",
            a: "ä¼ å…‰ã€åŠŸèƒ½",
            hint: "å…‰çº¤ä¼ æ„Ÿå™¨çš„åˆ†ç±»"
        }
    ],
    "ç¬¬10ç«  åŠå¯¼ä½“å¼åŒ–å­¦ä¼ æ„Ÿå™¨": [
        {
            q: "åŠå¯¼ä½“æ°”ä½“ä¼ æ„Ÿå™¨æ˜¯åˆ©ç”¨åŠå¯¼ä½“ææ–™ä¸æ°”ä½“æ¥è§¦æ—¶______å˜åŒ–çš„åŸç†ã€‚",
            a: "ç”µé˜»æˆ–åŠŸå‡½æ•°",
            hint: "åŠå¯¼ä½“æ°”ä½“ä¼ æ„Ÿå™¨çš„å·¥ä½œåŸç†"
        }
    ],
    "ç¬¬12ç«  çƒ­ç”µå¼ä¼ æ„Ÿå™¨": [
        {
            q: "çƒ­ç”µå¶æµ‹æ¸©å›è·¯çš„çƒ­ç”µåŠ¿ä¸»è¦ç”±______ç”µåŠ¿å’Œ______ç”µåŠ¿ç»„æˆã€‚",
            a: "æ¥è§¦ã€æ¸©å·®",
            hint: "çƒ­ç”µåŠ¿çš„ä¸¤ä¸ªç»„æˆéƒ¨åˆ†"
        },
        {
            q: "çƒ­ç”µé˜»å¤šç”¨äºæµ‹é‡______æ¸©åº¦èŒƒå›´ã€‚",
            a: "-200ï½+850â„ƒ",
            hint: "çƒ­ç”µé˜»çš„å…¸å‹åº”ç”¨èŒƒå›´"
        }
    ],
    "ç¬¬14ç«  ç”Ÿç‰©ä¼ æ„Ÿå™¨": [
        {
            q: "å¸¸è§çš„ç”Ÿç‰©ä¼ æ„Ÿå™¨åŒ…æ‹¬ï¼šé…¶ä¼ æ„Ÿå™¨ã€______ä¼ æ„Ÿå™¨ã€ç»†èƒä¼ æ„Ÿå™¨ç­‰ã€‚",
            a: "å¾®ç”Ÿç‰©",
            hint: "ç”Ÿç‰©ä¼ æ„Ÿå™¨çš„ä¸€ç§ç±»å‹"
        }
    ],
    "ç¬¬15ç«  é›†æˆæ™ºèƒ½ä¼ æ„Ÿå™¨": [
        {
            q: "æ™ºèƒ½ä¼ æ„Ÿå™¨æ˜¯é›†æˆä¼ æ„Ÿå™¨ã€______ã€é€šä¿¡æ¨¡å—åŠè½¯ä»¶ç®—æ³•çš„ç³»ç»Ÿçº§äº§å“ã€‚",
            a: "å¾®å¤„ç†å™¨",
            hint: "æ™ºèƒ½ä¼ æ„Ÿå™¨çš„æ ¸å¿ƒç»„æˆéƒ¨åˆ†"
        },
        {
            q: "é›†æˆæ™ºèƒ½ä¼ æ„Ÿå™¨çš„ä¸»è¦ç‰¹ç‚¹æ˜¯______é«˜ï¼Œä½“ç§¯å°ã€‚",
            a: "é›†æˆåº¦",
            hint: "é›†æˆåŒ–çš„ä¼˜åŠ¿"
        }
    ]
};

let currentChapter = "ç¬¬1ç«  æ¦‚è¿°";
let currentList = questionBank[currentChapter];
let currentIndex = 0;
let isEssayMode = false; // false:å¡«ç©ºé¢˜æ¨¡å¼, true:è§£ç­”é¢˜æ¨¡å¼
let stats = {
    learned: new Set(),
    correct: new Set(),
    attempted: new Set()
};

// ===== åˆå§‹åŒ–ç« èŠ‚æŒ‰é’® =====
const chapterBar = document.getElementById("chapters");
Object.keys(questionBank).forEach((ch, idx) => {
    const btn = document.createElement("div");
    btn.className = "chapter-btn" + (idx === 0 ? " active" : "");
    btn.innerText = ch;
    btn.onclick = () => switchChapter(ch, btn);
    chapterBar.appendChild(btn);
});

function switchChapter(chapter, btn) {
    currentChapter = chapter;
    currentList = questionBank[chapter];
    currentIndex = 0;
    document.querySelectorAll(".chapter-btn").forEach(b => b.classList.remove("active"));
    btn.classList.add("active");
    updateQuestion();
    updateStats();
}

// ===== æ˜¾ç¤ºé¢˜ç›® =====
function updateQuestion() {
    const questionNumber = document.getElementById("questionNumber");
    questionNumber.textContent = `ç¬¬${currentIndex + 1}é¢˜/å…±${currentList.length}é¢˜`;
    
    if (currentList.length === 0) {
        document.getElementById("question").innerText = "æœ¬ç« æš‚æ— é¢˜ç›®";
        document.getElementById("fillBlankArea").style.display = 'none';
        document.getElementById("essayArea").style.display = 'none';
        return;
    }
    
    const item = currentList[currentIndex];
    document.getElementById("question").innerHTML = item.q;
    
    // åˆ‡æ¢æ¨¡å¼
    if (isEssayMode) {
        // è§£ç­”é¢˜æ¨¡å¼
        document.getElementById("type").textContent = "è§£ç­”é¢˜";
        document.getElementById("toggleBtn").textContent = "åˆ‡æ¢ä¸ºå¡«ç©ºé¢˜";
        document.getElementById("fillBlankArea").style.display = 'none';
        document.getElementById("essayArea").style.display = 'block';
        
        // å¦‚æœæ˜¯å¡«ç©ºé¢˜ï¼Œåœ¨è§£ç­”é¢˜æ¨¡å¼ä¸‹ç›´æ¥æ˜¾ç¤ºç­”æ¡ˆ
        document.getElementById("correctAnswer").innerHTML = 
            `<strong>é¢˜ç›®ï¼š</strong>${item.q.replace(/_+/g, '<span class="blank">_____</span>')}<br><br>
             <strong>å‚è€ƒç­”æ¡ˆï¼š</strong>${item.a}`;
        document.getElementById("correctAnswer").style.display = 'none';
    } else {
        // å¡«ç©ºé¢˜æ¨¡å¼
        document.getElementById("type").textContent = "å¡«ç©ºé¢˜";
        document.getElementById("toggleBtn").textContent = "åˆ‡æ¢ä¸ºè§£ç­”é¢˜";
        document.getElementById("fillBlankArea").style.display = 'block';
        document.getElementById("essayArea").style.display = 'none';
        document.getElementById("userAnswer").value = '';
        document.getElementById("userAnswer").focus();
    }
    
    // æ›´æ–°æŒæ¡çŠ¶æ€
    const questionKey = `${currentChapter}_${currentIndex}`;
    if (stats.learned.has(questionKey)) {
        document.getElementById("question").style.color = "#2e7d32";
    } else {
        document.getElementById("question").style.color = "#333";
    }
}

// ===== æ£€æŸ¥å¡«ç©ºé¢˜ç­”æ¡ˆ =====
function checkAnswer() {
    const userAnswer = document.getElementById("userAnswer").value.trim();
    const correctAnswer = currentList[currentIndex].a;
    const questionKey = `${currentChapter}_${currentIndex}`;
    
    stats.attempted.add(questionKey);
    
    // ç®€å•æ¯”è¾ƒç­”æ¡ˆï¼ˆå®é™…ä½¿ç”¨å¯èƒ½éœ€è¦æ›´å¤æ‚çš„åŒ¹é…ï¼‰
    if (userAnswer.toLowerCase() === correctAnswer.toLowerCase() || 
        correctAnswer.includes(userAnswer) ||
        userAnswer.length > 0 && correctAnswer.toLowerCase().includes(userAnswer.toLowerCase())) {
        alert("âœ“ å›ç­”æ­£ç¡®ï¼");
        stats.correct.add(questionKey);
        stats.learned.add(questionKey);
        document.getElementById("question").style.color = "#2e7d32";
    } else {
        alert(`âœ— å›ç­”ä¸æ­£ç¡®ã€‚\næç¤ºï¼š${currentList[currentIndex].hint || "è¯·å†ä»”ç»†æ€è€ƒä¸€ä¸‹"}`);
    }
    
    updateStats();
    nextQuestion(); // è‡ªåŠ¨è¿›å…¥ä¸‹ä¸€é¢˜
}

// ===== æ˜¾ç¤ºæç¤º =====
function showHint() {
    const hint = currentList[currentIndex].hint || "æš‚æ— æç¤º";
    alert(`ğŸ’¡ æç¤ºï¼š${hint}`);
}

// ===== æ˜¾ç¤ºå®Œæ•´ç­”æ¡ˆï¼ˆè§£ç­”é¢˜æ¨¡å¼ï¼‰ =====
function showFullAnswer() {
    document.getElementById("correctAnswer").style.display = 'block';
}

// ===== æ ‡è®°ä¸ºå·²æŒæ¡ =====
function markAsLearned() {
    const questionKey = `${currentChapter}_${currentIndex}`;
    stats.learned.add(questionKey);
    document.getElementById("question").style.color = "#2e7d32";
    alert("å·²æ ‡è®°ä¸ºå·²æŒæ¡é¢˜ç›®");
    updateStats();
}

// ===== åˆ‡æ¢ç­”é¢˜æ¨¡å¼ =====
function toggleAnswerMode() {
    isEssayMode = !isEssayMode;
    updateQuestion();
}

// ===== å¯¼èˆªé¢˜ç›® =====
function prevQuestion() {
    if (currentIndex > 0) {
        currentIndex--;
    } else {
        currentIndex = currentList.length - 1;
    }
    updateQuestion();
}

function nextQuestion() {
    if (currentIndex < currentList.length - 1) {
        currentIndex++;
    } else {
        currentIndex = 0;
        // å¦‚æœåˆ°æœ€åä¸€é¢˜ï¼Œæç¤ºæ˜¯å¦å¾ªç¯
        if (currentIndex === 0 && currentList.length > 1) {
            if (confirm("å·²ç»æ˜¯æœ€åä¸€é¢˜ï¼Œæ˜¯å¦ä»å¤´å¼€å§‹ï¼Ÿ")) {
                updateQuestion();
            }
            return;
        }
    }
    updateQuestion();
}

// ===== æ›´æ–°ç»Ÿè®¡ä¿¡æ¯ =====
function updateStats() {
    const totalLearned = stats.learned.size;
    const totalAttempted = stats.attempted.size;
    const accuracy = totalAttempted > 0 ? 
        Math.round((stats.correct.size / totalAttempted) * 100) : 0;
    
    document.getElementById("learnedCount").textContent = totalLearned;
    document.getElementById("accuracy").textContent = `${accuracy}%`;
}

// åˆå§‹åŒ–
updateQuestion();
updateStats();

// é”®ç›˜å¿«æ·é”®æ”¯æŒ
document.addEventListener('keydown', function(e) {
    switch(e.key) {
        case 'ArrowLeft':
            prevQuestion();
            break;
        case 'ArrowRight':
            nextQuestion();
            break;
        case ' ':
            if (isEssayMode) {
                showFullAnswer();
            } else {
                checkAnswer();
            }
            e.preventDefault();
            break;
        case 'm':
        case 'M':
            toggleAnswerMode();
            break;
    }
});

// è¾“å…¥æ¡†å›è½¦æäº¤
document.getElementById('userAnswer').addEventListener('keypress', function(e) {
    if (e.key === 'Enter') {
        checkAnswer();
    }
});
</script>
</body>
</html>
